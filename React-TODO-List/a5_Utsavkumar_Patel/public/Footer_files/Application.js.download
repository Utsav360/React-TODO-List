"use strict";Type.registerNamespace("Panopto"),Panopto.Application=function(){Panopto.Application.initializeBase(this),Panopto.Application.defaultInstance=this,Sys.Application.add_navigate(this._handleNavigate.bind(this))},Panopto.Application.prototype={_state:{},authCookieMessageThreshold:3e4,init:function(){var e=this;if(new Panopto.ModalPopup,Panopto.Core.UI.Handlers.button($("#embeddedHomeButton, #embeddedSessionsButton"),(function(){var e,o=$(this).is($("#embeddedHomeButton"))?"Home.aspx":"Sessions/List.aspx",t=PanoptoTS.StringHelpers.format("{0}/Pages/{1}?embedded={2}",Panopto.appRoot,o,Panopto.embeddedModeView);(null===(e=Panopto.teamsApp)||void 0===e?void 0:e.isFromTeams)&&(t+="&isFromTeams=true"),location.href=t})),$get("searchQuery")&&($get("searchQuery").blur(),this._searchWatermark=Sys.create.watermark("#searchQuery",Panopto.GlobalResources.Application_js_SearchMessage,"ghosted"),this.ellipsisWatermarkText(),Panopto.Core.UI.Handlers.key($("#searchQuery"),this._handleSearchEntry,[Panopto.Core.Key.Enter],{context:this}),Panopto.Core.UI.Handlers.button($("#searchImageWrapper"),this._handleSearchEntry,{context:this,allowPropagation:!0}),Panopto.Core.UI.Handlers.button($("#cancelSearch"),this._handleSearchCancel,{context:this,allowPropagation:!0})),Panopto.Core.UI.Components.popup($("#loginDropdown"),$("#loginLink, #loginButton")),Panopto.useFreeTrialTerminology){var o=PanoptoTS.ImageHelpers.getImageUrl("Pro/videocam.svg");$("#headerRecord .videocam-icon").html('<img src="'+o+'" onload="SVGInject(this)" />'),Panopto.Core.UI.Handlers.button($("#headerRecord"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"header",action:"webrecorder-new-session"}),e.launchWebRecorder()}))}$("#supportLink").length&&new PanoptoTS.Core.UI.Components.PopupMenuBehavior({menuButton:$("#supportLink"),menu:$("#supportDropdown"),itemSelector:"a, input"}),$("#helpMenuVersion").focus((function(e){return $(e.currentTarget).select()})).click((function(e){return e.stopPropagation()})),Panopto.Core.UI.Handlers.button($("#launchAndroidApp, #launchIosApp"),(function(){var e=Panopto.Application.defaultInstance.getMobileLaunchUrl(Panopto.Core.Constants.AppBrowseAction);window.location.href=e})),Panopto.Branding.brandElements(Panopto.branding.accentColor),this.initCreateMenu(),$("a").each((function(){$(this).attr("aria-label",$(this).attr("title"))})),$(".utilityNav").toggleClass("is-logged-out",!Panopto.user.isAuthenticated),Panopto.Core.Browser.isMobileSafari&&($("#navBar").css("height","auto"),$("#content").css("border-left","1px solid #989898"),$(".pagination").css("bottom","inherit").css("border-left","1px solid #989898").css("margin-left","-1px")),this.startAuthCookieTimer(),this.showNotificationBannerIfNeeded()},showNotificationBannerIfNeeded:function(){Panopto.notificationMessage&&(Panopto.notificationMessage=Panopto.Core.StringHelpers.displayStringFromResourceString(Panopto.notificationMessage,"Resources.GlobalResources",Panopto.lang,Panopto.GlobalResources),this.showNotificationBanner(Panopto.notificationMessage,Panopto.notificationMessageId,!0))},showNotificationBanner:function(e,o,t,n){if(Panopto.Application.defaultInstance._state.notificationBannerShown)PanoptoCore.Logging.Logger.info("Attempted overwrite of a message banner");else{var a=$("#notificationBanner"),r=a.find("#notificationIcon"),i=a.find("#dismissButton");r.removeClass(),n&&r.addClass(n),e=e.replace(/&#39;/g,"'"),a.find("#notificationMessageText").html(e),a.slideDown(),a.addClass("clicked"),a.focus(),Panopto.Application.defaultInstance._state.notificationBannerShown=!0,t?(i.show(),Panopto.Core.UI.Handlers.button(i,(function(e,t){a.removeAttr("role"),a.slideUp(),Panopto.Application.defaultInstance._state.notificationBannerShown=!1,o&&PanoptoCore.CookieHelpers.setCookie(o+"_"+Panopto.user.userKey,"true",30),"keydown"===t.type&&$(":tabbable").not("#notificationBanner :tabbable").first().focus()}))):i.hide()}},startAuthCookieTimer:function(){var e=this;if(Panopto.user.isAuthenticated&&Panopto.authCookieTimeoutMinutes>0&&!Panopto.isIOS){this.wireUpLogoutWarningLink();var o=function(){var t=!0,n=PanoptoCore.CookieHelpers.getCookie("AuthRefreshTime");if(n){var a=new Date,r=new Date(parseInt(n,10));if(r.setMinutes(r.getMinutes()+Panopto.authCookieTimeoutMinutes),r.setSeconds(r.getSeconds()+1),!(t=a>r)){var i=r.getTime()-a.getTime();if(i<=e.authCookieMessageThreshold)$("#logoutWarningMessage").is(":visible")||e.showAuthExpiryWarning(Math.round(i/1e3)),setTimeout(o,1e3);else{e.hideAuthExpiryWarning();var s=i-e.authCookieMessageThreshold,l=2147483647;s>l&&(s=l),setTimeout(o,s)}}}if(t&&0!==window.location.href.indexOf(Panopto.loginUrl)){var c=encodeURIComponent(window.location.href);window.location.href=String.format("{0}?AuthExpired=true&ReturnUrl={1}",Panopto.loginUrl,c)}};o()}},showAuthExpiryWarning:function(e){var o=$("#logoutWarningText"),t=function(){o.text(Panopto.GlobalResources.Site_AuthCookieExpiry_Warning.format(e)),e>0&&e--};t(),this.countdownInterval=setInterval(t,1e3),$("#logoutWarningLink").text(Panopto.GlobalResources.Site_AuthCookieExpiry_StayLoggedIn),$("#logoutWarningMessage").show()},hideAuthExpiryWarning:function(){$("#logoutWarningInfo").hide(),$("#logoutWarningLink").show(),this.countdownInterval&&window.clearInterval(this.countdownInterval),$("#logoutWarningMessage").hide()},wireUpLogoutWarningLink:function(){var e=this,o=$("#logoutWarningLink"),t=$("#logoutWarningInfo");Panopto.Core.UI.Handlers.button(o,(function(){o.hide(),t.text(Panopto.GlobalResources.Site_AuthCookieExpiry_Communicating),t.show(),Panopto.Util.callWebMethod({serviceURL:PanoptoTS.StringHelpers.format("{0}/Services/Data.svc",Panopto.appRoot),methodName:"RefreshAuthCookie",onSuccess:function(o){e.hideAuthExpiryWarning()},onFailure:function(e){t.text(Panopto.GlobalResources.Site_AuthCookieExpiry_SomethingWentWrong),o.text(Panopto.GlobalResources.Site_AuthCookieExpiry_TryAgain),o.show()}})}))},initCreateMenu:function(){var e,o,t=this,n=PanoptoTS.Core.Permission,a=Panopto.Core.Constants.FolderIdParameter,r=Panopto.features.simplifiedRecorderDownloadEnabled&&!Panopto.user.sitePermissions[n.AdvancedRecorderDownload],i=(null===(e=Panopto.teamsApp)||void 0===e?void 0:e.isFromTeams)&&Panopto.Core.Browser.isMobileOrTablet,s=function(e){$("#simplifiedRecorderOptions").toggle(e),$("#allRecorderOptions").toggle(!e)},l=function(e){e=e&&!!$("#launchRecorderLink")[0].href,$("#simplifiedRecorderLaunch, #launchOptions").toggle(e),$("#simplifiedDownloadTitle").toggle(!e),$("#simplifiedDownloadDefaultTitle").toggle(e),$("#simplifiedDownloadButton").toggleClass("branded-button",!e)};if(s(r),l(!1),!Panopto.isHostedMaster&&(Panopto.user.somewherePermissions[n.SessionCreate]||Panopto.features.schedulingAvailableToCreators&&Panopto.user.somewherePermissions[n.SessionCreateScheduledRecordingRestrictedBySetting]||Panopto.user.somewherePermissions[n.SessionCreateScheduledRecording]||Panopto.user.somewherePermissions[n.FolderCreateRestrictedBySetting]||Panopto.user.somewherePermissions[n.PlaylistCreate])){if($("#createMenu").show(),new PanoptoTS.Core.UI.Components.PopupMenuBehavior({menuButton:$("#createButton"),menu:$("#createDropdown"),itemSelector:".menuItem"}),Panopto.Core.UI.Handlers.button($("#downloadRecorderButton"),(function(){Panopto.Application.defaultInstance.updateState({modalPage:"#recorderPopup",modalHeader:Panopto.GlobalResources.Controls_RecorderDownload_DisplayName,modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({modalIcon:"download-icon"})}),s(r),l(!1),Panopto.Core.ElementHelpers.putFocusIntoModal($("#recorderPopup"))}),{allowPropagation:!0}),Panopto.features.enableLegacyRecordingClients&&Panopto.user.somewherePermissions[n.SessionCreate]&&!(null===(o=Panopto.teamsApp)||void 0===o?void 0:o.isFromTeams)){var c=PanoptoTS.ImageHelpers.getImageUrl("Header/App_Icon.svg");$("#newRecordingLink .create-session").html('<img src="'+c+'" onload="SVGInject(this)" />'),$("#newRecordingLink .main-text").text(Panopto.Core.Browser.isMac?Panopto.GlobalResources.Controls_RecorderDownload_MacTitle:Panopto.GlobalResources.Controls_RecorderDownload_WindowsTitle),Panopto.Core.UI.Handlers.button($("#newRecordingLink"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"record-new-session"});var e=!1;Panopto.isIOS?e=!0:Panopto.isAndroid||(Panopto.Application.defaultInstance.updateState({modalPage:"#recorderPopup",modalHeader:Panopto.GlobalResources.Site_NewSessionLink,modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({modalIcon:"download-icon"})}),s(r),l(!0),$("#recorderLaunchedMessage").hide(),e=!!PanoptoCore.CookieHelpers.getCookie("launchRecorderCookie")),e&&Panopto.Application.defaultInstance.launchRecorder()}),{allowPropagation:!0})}else $("#newRecordingLink").hide();if(Panopto.features.panoptoWebEnabled&&(Panopto.user.somewherePermissions[n.SiteRecorderWebAdminOnly]||Panopto.user.somewherePermissions[n.SiteRecorderWebAllCreators]&&"adminsandcreators"===Panopto.features.panoptoWebAvailability)){var p=PanoptoTS.ImageHelpers.getImageUrl("Header/Capture_Icon.svg");$("#webRecorderLink .web-record").html('<img src="'+p+'" onload="SVGInject(this)" />'),Panopto.useFreeTrialTerminology&&($("#webRecorderLink .head-text").text(Panopto.GlobalResources.Site_WebRecorderLink_Pro),$("#webRecorderLink .sub-text").text(Panopto.GlobalResources.Site_WebRecorderLink_Text_Pro),$("#webRecorderLink .beta-label").hide()),Panopto.features.forceWebRecorderBetaLabel||Panopto.Core.Browser.isMobileOrTablet||Panopto.Core.Browser.isSafari||$("#webRecorderLink .beta-label").hide(),Panopto.Core.UI.Handlers.button($("#webRecorderLink"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"webrecorder-new-session"}),t.launchWebRecorder()}))}else $("#webRecorderLink").hide();Panopto.Core.UI.Handlers.button($("#advancedDownloadLink"),(function(){s(!1)})),Panopto.Core.UI.Handlers.button($("#launchRecorderLink"),this.launchRecorder),Panopto.Core.UI.Handlers.button($("#simplifiedLaunchButton"),this.launchRecorder),Panopto.user.hasUnison&&document.URL.split(":")[0]===Panopto.uriScheme&&Panopto.user.somewherePermissions[n.SessionCreate]?Panopto.Core.UI.Handlers.button($("#uploadLink"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"upload-media"});var e=null;if(Panopto.Application.defaultInstance._state[a]){var o={folderID:Panopto.Application.defaultInstance._state[a]};e=Panopto.Core.StringHelpers.serializeObjectToQueryString(o)}Panopto.Application.defaultInstance.updateState({modalPage:"BatchUpload",modalHeader:null,modalParams:e})}),{allowPropagation:!0}):$("#uploadLink").hide();var d=function(e,o){Panopto.Application.defaultInstance._state[a]&&(e.folderID=Panopto.Application.defaultInstance._state[a]),e.schedule?Panopto.Application.defaultInstance.updateState({modalPage:"CreateScheduledSession",modalHeader:o,modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString(e)}):Panopto.Application.defaultInstance.updateState({modalPage:"CreateSession",modalHeader:o,modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString(e)})};if(Panopto.features.broadcastEnabled&&Panopto.user.somewherePermissions[n.SessionCreate])Panopto.Core.UI.Handlers.button($("#webcastLink"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"webcast"}),d({broadcast:!0},null)}),{allowPropagation:!0});else if(Panopto.useFreeTrialTerminology){var u=$("#webcastLink");u.addClass("webcast-pro-show"),u.find(".webcast-pro-icon img").attr("src",PanoptoTS.ImageHelpers.getImageUrl("Header/Lock_NCA.svg")),u.find(".webcast-pro-hover-icon img").attr("src",PanoptoTS.ImageHelpers.getImageUrl("Header/Upgrade_Green_NCA.svg")),Panopto.Core.UI.Handlers.button(u,(function(){Panopto.GoogleAnalytics.sendProUpgradeEvent(PanoptoCore.ProUpgradeActions.Open,PanoptoCore.ProUpgradeLabels.OpenFromCreateWebcast),Panopto.ProUpgradePopup({startOnEnterprise:!0})}))}else $("#webcastLink").hide();var h=Panopto.features.schedulingAvailableToCreators?n.SessionCreateScheduledRecordingRestrictedBySetting:Panopto.features.remoteRecorderListOnlyAdmins?n.SiteAdminManageRemoteRecorders:n.SessionCreateScheduledRecording;Panopto.user.somewherePermissions[h]&&!i?Panopto.Core.UI.Handlers.button($("#scheduledLink"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"scheduled-recording"}),d({schedule:!0},Panopto.GlobalResources.ModalPopup_CreateScheduledRecordingDisplayName)}),{allowPropagation:!0}):$("#scheduledLink").hide(),Panopto.user.hasUnison&&Panopto.user.somewherePermissions[n.SessionCreate]?Panopto.Core.UI.Handlers.button($("#buildLinkUnison"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"build-session",label:"unison"}),d({build:!0},Panopto.GlobalResources.Site_BuildSessionLink)}),{allowPropagation:!0}):$("#buildLinkUnison").hide(),!Panopto.user.hasUnison&&Panopto.user.somewherePermissions[n.SessionCreate]?Panopto.Core.UI.Handlers.button($("#buildLinkNoUnison"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"build-session",label:"no-unison"}),d({build:!0},Panopto.GlobalResources.Site_NewPlaceholderSessionLink)}),{allowPropagation:!0}):$("#buildLinkNoUnison").hide(),Panopto.user.somewherePermissions[n.PlaylistCreate]&&!i?Panopto.Core.UI.Handlers.button($("#playlistLink"),(function(){var e={};Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"playlist"}),Panopto.Application.defaultInstance._state[a]&&(e.folderID=Panopto.Application.defaultInstance._state[a]),Panopto.Application.defaultInstance.updateState({modalPage:"CreatePlaylist",modalHeader:null,modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString(e)})}),{allowPropagation:!0}):$("#playlistLink").hide();var P=Panopto.features.creatorsCanCreateFolders?n.FolderCreateRestrictedBySetting:n.FolderCreate;Panopto.user.somewherePermissions[P]&&!i?(this.updateCreateFolderLink(null),Panopto.Core.UI.Handlers.button($("#folderLink"),(function(){Panopto.GoogleAnalytics.sendEvent({source:"create-menu",action:"new-folder"});var e=null;if(Panopto.Application.defaultInstance._state[a]){var o={parentID:Panopto.Application.defaultInstance._state[a]};e=Panopto.Core.StringHelpers.serializeObjectToQueryString(o)}Panopto.Application.defaultInstance.updateState({modalPage:"CreateFolder",modalHeader:null,modalParams:e})}),{allowPropagation:!0})):$("#folderLink").hide()}else $("#createMenu").hide()},updateCreateFolderLink:function(e){var o=e?String.format(Panopto.GlobalResources.Site_FolderLink_TextChild,e):Panopto.GlobalResources.Site_FolderLink_TextTopLevel;$("#folderLinkText").text(o)},updateState:function(e){for(var o in $.extend(this._state,e),this._state)null!==this._state[o]&&(this._state[o]=Sys.Serialization.JavaScriptSerializer.serialize(this._state[o]));Sys.Application.addHistoryPoint(this._state)},currentlySearching:function(){return!!this._state.query},_handleNavigate:function(e,o){for(var t in this._state=o.get_state(),this._state)if(null!==this._state[t])try{this._state[t]=JSON.parse(this._state[t])}catch(e){}this._navigate(e,o)},add_navigate:function(e){this.get_events().addHandler("navigate",e),e(this,new Sys.HistoryEventArgs(this._state))},remove_navigate:function(e){this.get_events().removeHandler("navigate",e)},_navigate:function(e,o){var t=this.get_events().getHandler("navigate");t&&t(this,o)},add_searchSubmit:function(e){this.get_events().addHandler("searchSubmit",e)},remove_searchSubmit:function(e){this.get_events().removeHandler("searchSubmit",e)},_searchSubmit:function(e){var o=this.get_events().getHandler("searchSubmit");o?o(this,new Panopto.Events.SubmitSearchEventArgs(e)):location.href=Panopto.Application.getBookmarkURL(Panopto.appRoot+"/Pages/Sessions/List.aspx",{query:e})},_handleSearchEntry:function(){var e=this.getSearchText();this._searchSubmit(e||null)},_handleSearchCancel:function(){$get("cancelSearch").blur(),this.setSearchText(""),this._handleSearchEntry()},_searchWatermark:null,setSearchWatermarkText:function(e){this._searchWatermark.set_WatermarkText(e),this.ellipsisWatermarkText()},setSearchText:function(e){this._searchWatermark.set_Text(e)},getSearchText:function(){return this._searchWatermark?this._searchWatermark.get_Text():$get("searchQuery").value},ellipsisWatermarkText:function(){var e=Panopto.Core.ElementHelpers.inputEllipsis($("#searchQuery"),this._searchWatermark._watermarkText,Panopto.GlobalResources.ViewerPlus_TitleEllipsis);e.ellipsied?$("#searchQuery").attr("title",this._searchWatermark._watermarkText):$("#searchQuery").attr("title",Panopto.GlobalResources.Site_SearchHover),this._searchWatermark.set_WatermarkText(e.text)},launchRecorder:function(){$("#launchRecorderLink")[0].href&&($("#recorderLaunchDiv").hide(),$("#recorderLaunchedMessage").fadeIn("slow"),$("#launchRecorderFrame")[0].contentWindow.location.href=Panopto.Application.defaultInstance.getRecorderLaunchUrl(Panopto.Core.Constants.AppRecordAction))},getRecorderLaunchUrl:function(e){var o=Panopto.appRoot+"/Pages/Recorder/LaunchRecorder.aspx",t={};return t[Panopto.Core.Constants.AppActionTypeParameter]=e,o=o+window.location.search+window.location.hash,o=Panopto.Core.StringHelpers.convertFragmentToQuery(o),o=Panopto.Core.StringHelpers.addQueryParameter(o,t)},getMobileLaunchUrl:function(e){var o=Panopto.appRoot+"/Pages/Mobile/iOSAppLaunch.aspx",t=Panopto.Core.StringHelpers.convertFragmentToQuery(window.location.href),n={};return n[Panopto.Core.Constants.AppActionTypeParameter]=e,n[Panopto.Core.Constants.MobileLaunchChoice]=Panopto.Core.Constants.MobileLaunchIgnoreCookie,n.ReturnUrl=t,o=Panopto.Core.StringHelpers.addQueryParameter(o,n)},launchWebRecorder:function(){var e,o,t=Panopto.appRoot+"/Pages/Capture.aspx",n=null===(o=null===(e=Panopto.SessionList)||void 0===e?void 0:e.defaultInstance)||void 0===o?void 0:o.getCurrentFolderProperties(),a=null==n?void 0:n.id,r=null==n?void 0:n.permissions;(null==r?void 0:r[PanoptoTS.Core.Permission.SessionCreate])&&(t=Panopto.Core.StringHelpers.addQueryParameter(t,{folderId:a})),window.open(t,"Capture","noopener")},showOverQuotaMessageInCreateMenu:function(){$("#createDropdown .session-create").hide(),$("#webRecorderLink").hide();var e=new PanoptoTS.Controls.CreateMenuQuotaMessage(Panopto.GlobalResources);$("#createDropdown").prepend(e.render())}},Panopto.Application.getBookmarkURL=function(e,o){return Panopto.Core.UrlHelpers.getStateURL(e,o)},Panopto.Application.SetClassName=function(e){for(var o=$("#content"),t=["content-sessions","content-scheduled","content-processing","content-allFolders","content-usage","content-users","content-groups","content-remoteRecorders","content-licenses","content-remote-recorders","content-oauth-client","content-network-access-rule-list","content-transcription-list"],n=0,a=t;n<a.length;n++){var r=a[n];o.removeClass(r)}t.indexOf(e)>=0&&o.addClass(e)},Panopto.Application.registerClass("Panopto.Application",Sys.Component),Panopto.Application.defaultInstance||new Panopto.Application;
//# sourceMappingURL=file://///seasyn/jenkinsbuilds/rel_rtc_11.10.0/11.10.0.00017/_PublishedWebsites/WebUI/Scripts/Panopto/Application.js.map
