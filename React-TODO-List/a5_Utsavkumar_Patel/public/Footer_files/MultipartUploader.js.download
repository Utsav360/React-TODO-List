"use strict";var Panopto=Panopto||{};Panopto.BatchUpload=Panopto.BatchUpload||{},Panopto.BatchUpload.Data=Panopto.BatchUpload.Data||{},Panopto.BatchUpload.MultipartUploader=function(e){var t,o=0,a=1,n=2,r=3,i=4,l={},p=0;function s(e){var t=l[e],o=t.file,r=Panopto.Core.ServiceInterface.MultipartUploadManager.predictRemainingSeconds(e);_.extend(this,{BytesUploaded:t.bytesUploaded,Extension:t.ext,Id:e,IsInvalid:t.status===i,Name:t.name,PercentUploaded:t.bytesUploaded/o.size*100,RemainingTime:r>=0?moment().startOf("day").seconds(r).format("HH:mm:ss"):"",SessionCreated:!!t.sessionId,SessionId:t.sessionId||Panopto.Core.Constants.EmptyGuid,Size:o.size,UploadInProgress:t.status===a,UploadNearCompletion:t.status===a&&t.bytesUploaded===o.size,UploadCompleted:t.status===n})}var d=function(){var e=_.countBy(l,(function(e){return e.status}));Panopto.BatchUpload.FileList.updateProgress({Total:_.keys(l).length,Invalid:e[i]||0,NotStarted:e[o]||0,Uploading:e[a]||0,Complete:e[n]||0,Failed:e[r]||0})};e.setupDragDrop=function(a){t=a,Panopto.Core.ServiceInterface.SessionUploadManagement.setHost(window.location.origin),Panopto.Core.ServiceInterface.MultipartUploadManager.setThrottlingDelay(Panopto.features.webUIDelayWhileThrottling);var n=function(e){e.stopPropagation(),e.preventDefault()},r=function(e){n(e),t.toggleClass("drop-target-drag")};_.each(["mouseover","mouseleave","dragover"],(function(e){t.on(e,n)})),_.each(["dragenter","dragleave"],(function(e){t.on(e,r)}));var l=function(t){var a,n,r,l=t.originalEvent,u=l.target.files||l.dataTransfer.files;u.length>0&&(n=u,r=[],_.each(n,(function(t,a){var n,l;n={file:t,id:p++,name:Panopto.Core.StringHelpers.parseFilename(t.name),ext:Panopto.Core.StringHelpers.parseExtension(t.name),bytesUploaded:0,status:o},(!_.contains(Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS,"."+n.ext)||Panopto.features.uploadByteLimit&&t.size>Panopto.features.uploadByteLimit)&&(n.status=i),e.registerFile(n.id,n),(l=new s(n.id)).Index=a+1,r[a]=l})),d(),a=r,Panopto.BatchUpload.FileList.addFiles(a)),c.val(null)};t.on("drop",(function(e){r(e),l(e)}));var u=!1!==Panopto.BatchUpload.Data.currentFolder.canPassMultiple&&!($.browser.safari&&$.browser.mobile&&$.browser.versionNumber<8),c=$("<input />",{type:"file",multiple:u,accept:Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS.join(",")}).on("change",l).hide().insertAfter(t);Panopto.Core.UI.Handlers.button(t,(function(){c.click()}),{keyEvent:"keypress"})},e.registerFile=function(e,t){l[e]=t,d()},e.removeFile=function(e){delete l[e],d()},e.startUpload=function(e,t,o){var p=l[e],f=new Panopto.Core.CancellableRequest,U=new Panopto.Core.CancellableRequest;p.sessionId=t,o=o||$.noop;var P=function(a,i){p.status=a,Panopto.BatchUpload.FileList.updateFile(new s(e)),d(),a===n&&o(!0),a===r&&(Panopto.BatchUpload.FileList.handleImportError(e,t,i),o(!1))};return p.status!==i&&(P(a),f=Panopto.Core.ServiceInterface.SessionUploadManagement.openUpload({sessionId:t,filename:p.file.name,startTime:new Date},(function(t){p.uploadId=t.ID;var o=function(t){p.bytesUploaded=t,Panopto.BatchUpload.FileList.updateFile(new s(e))},a=function(){U=Panopto.Core.ServiceInterface.SessionUploadManagement.closeUpload(t,(function(){P(n)}),(function(){P(r,"Failed to close upload.")}))},i=function(){P(r,"Failed to upload file.")};Panopto.BatchUpload.Data.useV2Upload?c(t,p,e,P,o,a,i):u(t,p,e,o,a,i)}),(function(){P(r,"Failed to open upload.")}))),new Panopto.Core.CancellableRequest((function(){f.cancel(),U.cancel()}))},e.stopUpload=function(e,t){var a=l[e];a.status=o,a.bytesUploaded=0,d(),Panopto.Core.ServiceInterface.MultipartUploadManager.cancelUpload(e,t)},e.pauseUpload=function(e){},e.resumeUpload=function(e){},e.uploadStarted=function(e){return!!l[e]&&l[e].status!==o},e.uploadCompleted=function(e){return!!l[e]&&l[e].status===n},e.isInvalid=function(e){return!l[e]||l[e].status===i},e.getSessionId=function(e){return l[e]&&l[e].sessionId?l[e].sessionId:Panopto.Core.Constants.EmptyGuid},e.resetSessionId=function(e){var t=l[e];t&&(t.sessionId=null,Panopto.BatchUpload.FileList.updateFile(new s(e)))},e.setTargetText=function(e){t.find(".uploader-text").text(e)},e.setComponent=function(e,t){e.Simulate=t};var u=function(e,t,o,a,n,r){Panopto.Core.ServiceInterface.MultipartUploadManager.queueUpload({file:t.file,fileId:o,uploadUri:e.UploadTarget},a,n,r),Panopto.Core.ServiceInterface.MultipartUploadManager.upload()},c=function(e,t,o,a,n,i,l){var p={fileId:o,file:t.file,streamUpload:e,bytesUploaded:[],contentStoreOpenUrl:void 0,contentStoreFileId:void 0,contentStoreUploadId:void 0};Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.getOpenContentStoreUploadUrl(p,(function(e){p.contentStoreOpenUrl=e.SignedUrl,p.contentStoreFileId=e.FileID,p.contentStoreUploadId=e.contentStoreUploadId,Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.queueUpload(p,n,i,l),Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.upload()}),(function(){a(r,"Failed to upload file.")}))};return e}(Panopto.BatchUpload.MultipartUploader||{});
//# sourceMappingURL=file://///seasyn/jenkinsbuilds/rel_rtc_11.10.0/11.10.0.00017/_PublishedWebsites/WebUI/Scripts/Panopto/BatchUpload/MultipartUploader.js.map
